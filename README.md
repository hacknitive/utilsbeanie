# UtilsBeanie

<!-- ![PyPI][]
![License][]
![Python Version][]
![GitHub Issues][]
![GitHub Stars][] -->

**UtilsBeanie** is a collection of ready-to-use mixins and utilities based on [Beanie ODM](https://github.com/roman-right/beanie) for MongoDB. It provides streamlined actions for CRUD operations, aggregation pipelines, and more, making it easier to build robust and scalable applications.

## Table of Contents

- [UtilsBeanie](#utilsbeanie)
  - [Table of Contents](#table-of-contents)
  - [Features](#features)
  - [Installation](#installation)
  - [Usage](#usage)
    - [Initialization](#initialization)
    - [CRUD Operations](#crud-operations)
    - [Aggregation](#aggregation)
  - [Contributing](#contributing)
  - [License](#license)
  - [Contact](#contact)

## Features

- **CRUD Mixins**: Simplify Create, Read, Update, and Delete operations with predefined mixins.
- **Aggregation Pipelines**: Build complex aggregation pipelines effortlessly.
- **Utility Functions**: Helper functions for common tasks like pagination, sorting, and filtering.
- **Flexible Configuration**: Easily customize field separators and other configurations to fit your project's needs.
- **Asynchronous Support**: Fully compatible with asynchronous programming for high-performance applications.

## Installation

Install **UtilsBeanie** from [PyPI](https://pypi.org/project/utilsbeanie/) using `pip`:

```bash
pip install utilsbeanie
```

## Usage

### Initialization

Initialize **UtilsBeanie** using the `Engin` class, which provides static methods to build the connection string and initialize the Beanie client. This approach eliminates the need to manually use `AsyncIOMotorClient` and `init_beanie`.

```python
from utilsbeanie.engine import Engin
from utilsbeanie import UtilsBeanie
from your_project.models import YourDocument

# Step 1: Create the connection string
connection_string, database = Engin.create_connection_string(
    host="localhost",
    port=27017,
    database="your_database",
    username=None,        # Replace with your username if applicable
    password=None,        # Replace with your password if applicable
    authdb=None            # Replace with your auth database if applicable
)

# Step 2: Initialize the Beanie client
await Engin.init_beanie(
    connection_string=connection_string,
    database=database,
    list_of_documents_pathes=[YourDocument]
)
```

**Notes:**

- **`create_connection_string`**: Constructs the MongoDB connection string based on provided parameters.
- **`init_beanie`**: Initializes the Beanie ODM with the connection string, database name, and list of document models.

### CRUD Operations

For performing CRUD operations, inherit from the `UtilsBeanie` class. This provides access to various mixins that simplify database interactions.

```python
from utilsbeanie import UtilsBeanie
from your_project.models import YourDocument

class YourService(UtilsBeanie):
    def __init__(self):
        super().__init__(document=YourDocument)

# Initialize your service
service = YourService()

# Create a new document without PID
new_doc = await service.insert_one_without_pid({"field1": "value1", "field2": "value2"})

# Create a new document with epoch PID
new_doc_with_pid = await service.insert_one_by_epoch_pid({"field1": "value1", "field2": "value2"})

# Fetch a document by ID
fetched_doc = await service.fetch_one_by_id(new_doc.id)

# Fetch a document by PID
fetched_doc_by_pid = await service.fetch_one_by_pid(new_doc_with_pid.pid)

# Update a document by ID with return
updated_doc = await service.update_one_by_id_with_return(new_doc.id, {"field1": "new_value"})

# Update a document by PID without return
await service.update_one_by_pid_no_return(new_doc_with_pid.pid, {"field2": "updated_value"})

# Delete a document by ID
await service.delete_one_by_id(new_doc.id)

# Check existence of a document by filter
is_absent = await service.is_one_item_absent_by_filter({"field1": "value1"})
```

**Key Operations:**

- **Insert Operations**:
  - `insert_one_without_pid`: Inserts a document without a PID.
  - `insert_one_by_epoch_pid`: Inserts a document with an autogenerated epoch PID.

- **Fetch Operations**:
  - `fetch_one_by_id`: Retrieves a document by its ObjectID.
  - `fetch_one_by_pid`: Retrieves a document by its PID.

- **Update Operations**:
  - `update_one_by_id_with_return`: Updates a document by ID and returns the updated document.
  - `update_one_by_pid_no_return`: Updates a document by PID without returning the updated document.

- **Delete Operations**:
  - `delete_one_by_id`: Deletes a document by its ObjectID.

- **Existence Checks**:
  - `is_one_item_absent_by_filter`: Checks if a document matching the filter is absent.

### Aggregation

Build and execute aggregation pipelines easily using the provided mixins.

```python
from utilsbeanie import UtilsBeanie
from your_project.models import YourDocument, RelatedDocument

class YourAggregationService(UtilsBeanie):
    def __init__(self):
        super().__init__(document=YourDocument)

# Initialize your aggregation service
agg_service = YourAggregationService()

# Build an aggregation pipeline
pipeline = agg_service.build_aggregation_pipeline(
    attributes=[
        ("related_collection", RelatedDocument)
    ],
    final_projection={"field1": 1, "field2": 1}
)

# Execute the aggregation
results = await agg_service.fetch_by_aggregation_pipeline(pipeline)
```

**Key Functions:**

- **`build_aggregation_pipeline`**: Constructs an aggregation pipeline based on provided attributes and final projections.
- **`fetch_by_aggregation_pipeline`**: Executes the aggregation pipeline and retrieves results.

For more advanced aggregation scenarios, you can utilize additional mixins and utilities provided by **UtilsBeanie** to handle grouping, filtering, and more.

## Contributing

Contributions are welcome! Please follow these steps:

1. Fork the repository.
2. Create a new branch: `git checkout -b feature/YourFeature`.
3. Commit your changes: `git commit -m 'Add some feature'`.
4. Push to the branch: `git push origin feature/YourFeature`.
5. Open a pull request.

Please ensure your code adheres to the project's coding standards and includes relevant tests.

## License

This project is licensed under the [MIT License](LICENSE).

## Contact

For any inquiries or support, please contact:

**Reza 'Sam' Aghamohammadi (Hacknitive)**  
üìß [hacknitive@gmail.com](mailto:hacknitive@gmail.com)  
üåê [GitHub Repository](https://github.com/hacknitive/utilsbeanie)

---

*Thank you for using **UtilsBeanie**! We hope it makes your development process smoother and more efficient.*